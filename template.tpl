___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "webtru CMP",
  "categories": ["TAG_MANAGEMENT"],
  "brand": {
    "id": "brand_dummy",
    "displayName": "",
    "thumbnail": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAG0AAABuCAYAAAAtbJ34AAAACXBIWXMAAAsSAAALEgHS3X78AAAQ4UlEQVR4nOVdvVIrORZWs64i2KmyiSDDPIF9nwCIyAAHxNdkZGOeAPMEmGidjR1Ttf6JlmjME6z7Ca6dmWjskCpqekvtT9xDI6kltboNd7+qWzNg05b76Jzz6dPR6SCKIvYrIXhYnDPGJtHF3vKX+mIEv4TRgodFlTHWxL99xtg3VgrbjLFl1DhpBoPHDmNsyhgbRo2TL2/ML2204GFxBEN9J7+es1JYZ4z9hZ/7jDFutAl+7vGfo8bJbAND9oIvZ7TgYVFhjPEQ2IZXJXHPSiH3qj/I72+5l8FwZfzuiRswapz0iv8W2fBljBY8LLj3tGCwsuatx6wUJr2P45Ixxr3rz8Tv5/C+3lfxvk9vtOBhIXLVocHbV9HFXiUYPC4Vhr3Ef/+QvMYQSrnxJorXPwU+pdEIsWileFUSfVYKeRgcKF5fMcZ4HqxrDMfgfR0Y8NMRl09lNBALbqgzx0s0WCnk1/hd8x5huGbK+8R7hyAuU8cxecfGjQZiIbxKRixssAMSknadFbytLcl9Knwa4rIxoxFiYXrT0jDC2uy/hu8P4XE9S89ebXrZULjRQCy4sWqeL32J9VlayKMIYbCR43hG8L6hw986oxCjgVi0EAZtiIUNDkBCbG/+E5YRkwwTqVDikqvRoAO2DOl6FoSsFPLP+uF4jT7GOfMwqfp5ExfvRgOxaBEdsAhcsxKPdOwuw2dRuctHNAhxPe96pzejKXTAosAF4o4Hj76G0XwZjuVBXLwYLXhY9DZkLCYRiLOCqyZLzQI9C/p81yHrRbayXoCQjGsk5KIxBJHwBa6UVIjk5QtzjDUzMhsNyV8k3Xos2K6pcFHwbTSGXDT1ZLhVvMvw/FLn/4LuOLPhnI3GmSFIRwjCcYcQ1YTScIAtkTy9jwvEEyySfaKMvDYFQXHFKJ7Izy9TXOsmvneDx2oweKy7XjSLp/XgWcnk+h2qxBCv1TFjnzzeVIFhMHhM26pxhTBc28Fw8zjiPL+02fNLD/lRMOkpIkPHdWBORoOqUcYMV61HasgPwnBNeN89QoYP5BEaKcr4jJZhyKeh8ByTN8loZ8iZh9zjXAbl6mmCAVXJNr4KZUhLP+CdU/zdJUKrM6KLvWEOoTGJGr7j72S8sknXj7/X88sMhlHJaTMy5pbLgKyNBqFXzJ6qJDzqcAjvE4Y7j9dY6y9s630j5IUiFvDccPdR44R/3k7UOKmQnD1CKOyw55chvp8yXEdXpxN8d0YmvxVcPI3OjsPoYs9lwbiPpPwDOaOHL2KzbBi6fmlHxMRBqBt8oRw1TtpR4+RcEwqTEBNTTLRyMHi0/g5WRiNFNfR39Ywk4wx1G8llgy75P8FozgzMEisVcQi644rFzsJUwhqtQ2TJ8v0yplbFDc8qIYllw52o1YAX0nrGWNgVhajBIMz6uSHUD0Zy84yE/KmBbmgzcaYkNArUuCFtBGZbo7Ulv5PR/qz4jn9CdOWfUY0u9pJfrI2kTrdUVsRrqQGEUZb0BgXdcR1sriI+B9es4nUxKebR1amM7dmEt5nCyC2b6xhrjxCEk+VnDIm4o3jNF+LyAFX+DAaPR9QrELLEzRFGYYS1VR0JzNrTr07p59honsdsd1tVA7Njuhtg42mqmVDXrNV8oaxlqs8v/EZUiFfkBe7950F3PI099uqU///cYgLMyASS3V+jBbcREYEorFLx95Fj8pKr+HUvIVep0MkhRKtQRh49C7rjtiJlSBFdnc40OdiYkJiyR228Rej0fdPmb3UfpZAXoE5l9BizvgniItZOvhSXNLTAYk0m7FOKArKPMJ8KL0YzVEZM8YT6RW4sERLvQDbiWR10xx1urKA7bpIyuD+F3hldnVZy1DspyjCcibctJcwxCSNvSyUi0Bl11bgMeuIk48bhU/zlS+FMUwQ0ikXY92Vy3ySFp2+7xcghPkv1kliRZY8ut92y3e2lQUnEQdoOt4mnmVDRLLS/j3KBJg5O/IABZFKQTAUZYqZTHZPqnUJx2clpo7ZsSNllazQZUu+31mggICaMrC5ZQ6Whj7K3HiuFLdzgNG+Q7Z3twyjnilwmU1wankPnDSat7pqqNVoSqSEyzdNMGU0ZBk5T7VcgCsJYPdxQk9AVsucX/l9ZbeIZjKabpUJxmZH3HjiK1TJomWR0dTo1NFqqHqk0GqmxN0VVs14TxqrGOeunsWzWVWnbMMIg9ynXKWOSiK2iIdkqyhI6v2u8TVzXdLPWzWgGh/coQgy4laDcc9wMYSxxQtNlEWyy4SnLbzocgjyJfJO1xkXlbTNTOg8c6soRdEYzDY3cMEdcYuKL7Ohir40bcCzWWMRYrntfK+iFaQcl0vKb7u9uFDUuNtdRedvEkIRQKO+/1GhYLJvWtbeT7R/in9fUXayxsm5UDoPu2LSswCS/6SBqXHqJNZ+p93Ykn22yRkviPBg8SiUvlafZKtcy1D0W3NhWXJnmNx3iXfagO16SXfa0fT6GSVNNvM+UhFCUVengg9FAQGwWoqoZ5HNX2aWAxza/qVAmu+xNsubTlQcmc5vpGk12nQ+QeZrNzb6PLvZ6SU0NP7sewU3iiT2/VBxCrGt+0+E7WfPpygMPYaR77MMtHY9RSfVImdFMCMgcRIPXHfLB/4Cg2w4Gjy3IML6Uhyxlclnzmwr7kvLAZIGSIDRi7K6M9KNITrVHnCdL0w9H8YXWKsaN4j23mI0+DjF8iyudspUVyPRJ3xjBsycw1AyVV28IBo+uB1Xe6ZFJT9PNyBW2SrioO9EYjOG1qYea/jnqCLNubvrKbzqckTXfNGkwwKnOMWmXN6NBhlLloac4DPA1l/kx1x4GmSWf+KrTzyO/6T5LahyUE7hMHLnRNLPgNj4auz60d2dB4w9JDytX+Cz7ziu/yaAbc8tBrN7HmYUY1GjJLxNiy0QwJRc2KLZFnBR1dA3wWfYt1m+3Hq8pQxlVXm/gS6ngYdFhr7Uj9lpzOdfw5lQxEZFsdN6zrec7trW49pC8RzCeaX+Pn3/3ccPTB8Sm5TDHA/z3bHe797aue60tEerpsmXdTGa9ZDLt/xUTEuFpwstW2Orvsa3FyBPbOsPuse3snuR0IqZMwm4e+a3Pdrfb5NBGW1Gyt1ZcHhZL9lqrG3pf7G1b5EDFCGp8HbPbZ3OWHjzZZu2W5zGmQ9KG0CdC9lvpJnHQvpJSSfZzl/21xr1yigMeskU77xJb2cLi8Dped62bp+iovCv2MQhTEsA3PF1VBFOI7+krv8W7Heyf/7hPjNsmBKd5X6xHbvGYykrh0lM9vg43ULtN1m55hcYkhlDls5YerOLx7m53NITNJsrovG8WsH//R1XunQdES6O0zjjHqBr2pV/qYDomHb6x3e0jTaXVQXzzsznFW4XZFrqI7sCK/ZwPth8STU45OIwp7xOedExZ8tsl292up5TGOR3TTUB432Qr6I5n8en79TnhYfzftVZ3nVNribS12yTojo9ybHwmg2t+47WMU8MafF/FvNMt3MB9WHEQb7mvj6Lygw38pGOAzb97T9pdmUhcMuR9+F0F2/zWx1rMpCWTz6jRC9i/RtWU7m0r0h59girZcwzkKEMpwTH+PslWd9jzS5Y2fllgmt9C5DDTcd6y19rMoFI7DfPoYq+6hZMcujAoSs7+iI3LbyhCadQ4qZJQasvAZGu3EBuemzAYM8xvoiOrzcSybSigQhyGhSJi04ikJkJp0B1HJJS2EEobhqF0H8ama7dNhUYKXX6j1N5mYvkgIgwT/ecmaExIsldNJUMpI2FUVUd5gNcq8eRZU/08Fvg2EPokZbnrnsu72+cO4wt5O4vgYZGl5V8/utiLJzg9CdrJ2OSSkVC63p19fglhwF50ddpEAaYwoFizHEWNkzdPD7pjQVKKZI9J8M9uRlen78gSxu8yoXyE+7cu5VuJX/oWUEUo/ROhtJ0Ipd+SLdORY4vsD6KCrFtc1rzkugYOqX75vkZkPcuLarY5x6FzaSu9oDuueswFtpiKw/AfxjV4nDp6zjf2WnOtdbmM5UYgeVC+U6DR9kWP3+QLcWXtOtmrDpXnDZ23u04k1++ySt6jDydBcYa5SMp9LKlaGhakO+pwy9soJcZlUq2mQiNW7u1zIq8tfZdbZXWPzn0IXUGLXZHsN20wjhsxLpQKVEl3Hxe4toT6YI8PRouuTvMgJCqM2O72DD2jomDwOMHpmKI+XwcuXM+Ch8UUp2mmUDWy6LG2ROZJ1vBGdQCjiIfgrEhtvKD3hwhBhT4GRIEeamdEqhCaadNxUrmcS5faQWW0IkJkk+1uy4pZTFs85A3ZkaVD9lqz6mNFYEtE5pQxUkiNZqBHZsUIWxoy4wgj5t0DRIcn9lpjCnp+gzBpe4wqrVYkCWW0050EzStEysJiEu1NECIC3dYRi1//e+/OcrFsy8jtjYZFbx672E10YtMtMsVTljbxcIY5e62ldW2tsb93rx3FbZPv1Nd1rE1rSeHb2wRbTFurlG26snlGTyNuU/zOXmtW9ZxYzpiQEe19TzOaz5tGw6IJWjnpoWlIC40UQ0hTpjv6JmRknpb7tEaD/pblCRAUIiyaxvZ97AgUSf9H8B7TMZYtT+NUDGpFUpmzSW8sHyHSNCwmUTT9t/EygbP4UIXZONNUkQ86owypRoMumKWgxzYsUhRJ/zkBcS2S7YC8mCyTdDltmGzvIYNpv8csuc02LCZRFP3vWHYpojBVS9KIiL92uHBZF0LgGhYpiqL/vYyh2EQt0RGRJ9NOfkZGAyGxDW9ZwiJFEfS/j22TrDUyaWqJThUxvk82T8CwvWlZwyJF3vS/57HEQaeWqO7FSqUzymBsNOiRpoTAR1ikyJP+cwIy9bhjb6KWJA1q5RC2DwgymQ2+wmISedF/mZqfFUq1RKGKWN0rK6NhgzSNEPgMixR50P+V49rMBCq1JElGRrZPxnJ5FJduVvgOi0n4pv9DLIzzeAabSi1JqiLWEcmn0fIKixS+6X8eoZGCqyXnCU+mqsgcT1u0grXRQEhkemReYZHCJ/0P0Soi7yKiNpQWqpaIcOj0PVyfCZr0przDIoUv+p+3lwmIFhhCLaFExCkqORkNeqQIUUWERQof9H9FbmQRqEEtEQdNltjodCrJM35+2oc/7I5bOLDRwJnjIk+6POGG6w5D6nCPtVnWQ3624G2rlmmPJUmD7ZMKKXrxjFmHRR99HW1A6b9LbXynwMhAMYRclgnOT5TneiTWbXmscUzgSv91lVZ5Y9/HoUlnoxG0PT76wwau9H9TE20OhSSzFOec0z5caN1DXvR3LOKB4QzHf5nFYUhe6l2J2xgVd2jxrducrwt6M9q7i647XDcLODY1JxTaxAi+ugykQbDTtuPD27XIxWgCOHVCn1OdBxrwcJMJ4qPdkQ7iEc9GZQOuyNVoFDhYkVak6gJT+s8rrfJo+snEw9Qty76dUZjRBOB9qsdHuuIABEM3IRrQAX2F7LloMJanV8lQuNEECHHxoVf2kUNU68U51kdZOs0JjOBVGzuOtTGjvRtEduKS9jDVrARkRbyqqOdpK/EpjCYA72vC+2yJi47+H6Au0dajQxhqE+qJEp/KaBQgLk2LrRMV/e+DMZo2IhV0vePwcNpC8GmNJmBJXGT0/xi9gNNC71xokkUTC1t8eqNRGPSvT9J/QUD+0lx2BK8qhK77wJcymgAqmlqKMm5K/68hDifz3Ip41caJhS2+pNEEFMSF0v8d7JuJ17zrgJvAlzYaBVk2nMeiMPfGtZdN8tQBN4Ffxmj/N2CM/Q9McN6zAQ8CkQAAAABJRU5ErkJggg\u003d\u003d"
  },
  "description": "webtru is a tool designed to help businesses manage user consent for data collection, ensuring compliance with various data privacy regulations.",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "TEXT",
    "name": "tagId",
    "displayName": "webtru widget tag ID",
    "simpleValueType": true,
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ]
  },
  {
    "type": "RADIO",
    "name": "useGoogleConsentMode",
    "displayName": "Do you use Google Consent Mode?",
    "radioItems": [
      {
        "value": false,
        "displayValue": "No"
      },
      {
        "value": true,
        "displayValue": "Yes"
      }
    ],
    "simpleValueType": true
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

const log = require('logToConsole');
log('data =', data);

const setDefaultConsentState = require('setDefaultConsentState');
const updateConsentState = require('updateConsentState');
const encodeUri = require("encodeUri");
const setInWindow = require('setInWindow');
const injectScript = require("injectScript");
const gtagSet = require('gtagSet');

gtagSet('developer_id.dNWE3Yj', true);

const updateConsent = (payload) => {
    updateConsentState(payload);
    log('updateConsentState: payload = ', payload);
};
setInWindow("webtruGcmUpdateListener", updateConsent, true);

if (data.useGoogleConsentMode) {
    setDefaultConsentState({
        ad_storage: "denied",
        analytics_storage: "denied",
        ad_user_data: "denied",
        ad_personalization: "denied",
        wait_for_update: 500,
    });
}

const scriptURL = "https://cmp.datasign.co/v2/" + encodeUri(data.tagId) + "/cmp.js?gcm=v2";
injectScript(scriptURL, data.gtmOnSuccess, data.gtmOnFailure);


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "webtruGcmUpdateListener"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://cmp.datasign.co/v2/*"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_consent",
        "versionId": "1"
      },
      "param": [
        {
          "key": "consentTypes",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "ad_storage"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "analytics_storage"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "ad_user_data"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "ad_personalization"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "write_data_layer",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keyPatterns",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "developer_id.dNWE3Yj"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []


___NOTES___

Created on 2024/9/5 15:43:55


